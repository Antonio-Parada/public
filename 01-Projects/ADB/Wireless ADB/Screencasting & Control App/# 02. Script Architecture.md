# 02. Script Architecture

## 1. The Wizard (`add-device.sh`)
*Usage: Plug in a new device and run this to generate configs automatically.*

```bash
#!/bin/bash
# ~/Work/adb/add-device.sh
GREEN='\033[0;32m'
NC='\033[0m'

read -p "Friendly Name (e.g., 'Galaxy Tab'): " NAME
read -p "Short ID (e.g., 'tablet'): " ID
read -p "Tailscale IP: " IP

echo "Connect USB to Inject Port 5555..."
adb wait-for-device && adb -d tcpip 5555
sleep 3

SCRIPT_PATH="$HOME/Work/adb/$ID/${ID}-ctl.sh"
mkdir -p "$(dirname "$SCRIPT_PATH")"

# Generate Controller Script
cat <<EOF > "$SCRIPT_PATH"
#!/bin/bash
SERIAL="${IP}:5555"
adb connect \$SERIAL > /dev/null 2>&1
exec scrcpy -s \$SERIAL --window-title "$NAME" --max-size 1024 --always-on-top --turn-screen-off --stay-awake > /dev/null 2>&1
EOF
chmod +x "$SCRIPT_PATH"

# Symlink & Add to List
ln -sf "$SCRIPT_PATH" "$HOME/.local/bin/${ID}-ctl"
echo "  $NAME|${ID}-ctl" >> "$HOME/Work/adb/devices.list"
echo -e "${GREEN}Device Added!${NC}"
```

## 2. The Dynamic Menu (`android-menu.sh`)
*Usage: The central hub launched by Hyprland.*

```bash
#!/bin/bash
# ~/Work/adb/android-menu/android-menu.sh
CONFIG="$HOME/Work/adb/devices.list"
export PATH="$HOME/.local/bin:$PATH"

# Build Menu: Devices + Repair Option
OPTS=$(cat "$CONFIG" && echo "  Repair Connection|repair-link")

# Select & Extract Command
SELECTED=$(echo -e "$OPTS" | awk -F '|' '{print $1}' | wofi --dmenu --cache-file /dev/null --prompt "Android")
CMD=$(echo -e "$OPTS" | grep "^$SELECTED|" | cut -d '|' -f 2)

if [[ "$CMD" == "repair-link" ]]; then
    # Launch interactive terminal for Repair
    exec uwsm-app -- xdg-terminal-exec --class="repair_term" bash -c "$CMD; exec bash"
elif [[ -n "$CMD" ]]; then
    # Launch silent controller
    exec "$CMD"
fi
```

## 3. The Repair Tool (`repair-link.sh`)
*Usage: Restores the 5555 injection after a device reboot.*

```bash
#!/bin/bash
# ~/Work/adb/repair-link.sh
echo "Connect USB to restore wireless bridge..."
adb wait-for-device
adb -d tcpip 5555
echo "Success! Port 5555 open. You may unplug."
sleep 2
```

## Installation
```bash
chmod +x ~/Work/adb/*.sh ~/Work/adb/android-menu/*.sh
ln -s ~/Work/adb/android-menu/android-menu.sh ~/.local/bin/android-menu
ln -s ~/Work/adb/add-device.sh ~/.local/bin/add-device
ln -s ~/Work/adb/repair-link.sh ~/.local/bin/repair-link
```